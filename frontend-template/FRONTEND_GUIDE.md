# Frontend Setup & Troubleshooting Guide

## Overview

The frontend is a Next.js 15 dApp that connects to your deployed FHEVM smart contract via Web3. It automatically renders all your contract's functions and handles FHE encryption/decryption.

---

## ğŸ“‹ Quick Setup

### 1. **Deploy Your Contract First**

```bash
# From root directory (not frontend/)
npm install
npm run compile
npm run test  # Verify it works
npm run deploy:localhost  # Or deploy:sepolia
```

Note the **deployed contract address**.

### 2. **Setup Frontend Environment**

```bash
cd frontend
cp .env.local.example .env.local
```

Edit `.env.local`:
```env
NEXT_PUBLIC_CONTRACT_ADDRESS=0x... # Your deployed contract address
NEXT_PUBLIC_REOWN_PROJECT_ID=a48da7a491bae47d2886a44f914efc8a # Pre-filled for dev
```

### 3. **Generate Contract ABI**

```bash
npm run sync-abi
```

This creates `lib/contract-abi.json` from your compiled contract.

### 4. **Start Development Server**

```bash
npm install
npm run dev
```

Open [http://localhost:3000](http://localhost:3000)

---

## âœ… Contract Must Work First!

**Always test your contract independently before debugging frontend:**

```bash
cd ..  # Go to root
npm run test
```

Expected output: âœ… All tests passing

If tests fail â†’ fix contract â†’ don't debug frontend yet.

---

## ğŸ”§ Hydration & SSR Issues

### "Hydration Failed" Error

**What it means**: Server-side render output doesn't match client render.

**Why it happens**: Components access `window` or `Date` during SSR.

**Fixed in this template**: âœ… The `layout.tsx` and `GenericInteraction.tsx` now safely handle client-side mounting.

**If you still see it**: 
- Hard refresh (Cmd+Shift+R)
- Clear browser cache
- Restart dev server

---

## ğŸ” Wallet Connection Issues

### "Origin not found on Allowlist" Error

**Why**: Reown (WalletConnect) doesn't recognize your domain.

**Solution**: 
- **Local dev**: Uses pre-filled project ID (works out of box)
- **Production**: Get your own from [cloud.reown.com](https://cloud.reown.com) and update `.env.local`

---

## ğŸ” ABI Synchronization

### ABI Not Found?

```bash
# Make sure contract compiled
npm run compile  # From root

# Then sync
npm run sync-abi
```

Should create `lib/contract-abi.json` automatically.

**Manual fix** if needed:
```bash
# Copy from artifacts
cp ../artifacts/contracts/YourContract.sol/YourContract.json lib/contract-abi.json
```

---

## ğŸ§ª Testing Without Frontend

Always start here:

```bash
# From root directory
npm run compile    # Compile Solidity
npm run test       # Run test suite
npm run deploy:localhost  # Deploy locally
```

If all âœ…, contract is working. Any frontend issues are just UI.

---

## ğŸ“š Frontend Structure

```
frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                    # Home page
â”‚   â”œâ”€â”€ layout.tsx                  # Root layout (with SSR safeguard)
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ GenericInteraction.tsx  # Auto-renders contract functions
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ wagmi.ts                    # Web3 config
â”‚   â”œâ”€â”€ fhevm.ts                    # FHE setup
â”‚   â””â”€â”€ contract-abi.json           # Generated by sync-abi
â””â”€â”€ .env.local                      # Your personal config
```

---

## ğŸš€ Deployment Steps

### Local Network

```bash
# Terminal 1
npx hardhat node

# Terminal 2
npm run deploy:localhost

# Terminal 3 (frontend/)
npm run dev
```

### Sepolia Testnet

```bash
# Get Sepolia ETH from https://sepoliafaucet.com/

# Deploy
npm run deploy:sepolia

# Update .env.local with address

# Sync ABI
npm run sync-abi

# Start frontend
npm run dev
```

---

## ğŸ†˜ Quick Troubleshooting

| Issue | Check | Fix |
|-------|-------|-----|
| "No functions found" | `ls lib/contract-abi.json` | Run `npm run sync-abi` |
| Wallet won't connect | Browser console | Try different wallet extension |
| Hydration mismatch | Hard refresh | Cmd+Shift+R (or Ctrl+Shift+R) |
| Contract address invalid | `.env.local` | Copy correct address from deployment |
| "Module not found" errors | `npm install` | Reinstall: `rm -rf node_modules && npm install` |

---

## ğŸ“– Available Commands

```bash
# Development
npm run dev              # Start dev server
npm run build            # Build for production
npm run start            # Start prod server
npm run lint             # Check code style

# Contract interaction
npm run sync-abi         # Sync ABI from artifacts (from frontend/)
npm run compile          # Compile contracts (from root!)
npm run test             # Test contracts (from root!)
npm run deploy:localhost # Deploy to local (from root!)
npm run deploy:sepolia   # Deploy to testnet (from root!)
```

---

**For comprehensive setup guide, see [GETTING_STARTED.md](../GETTING_STARTED.md)**
